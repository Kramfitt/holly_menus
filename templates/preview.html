{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2>Next Menu Preview</h2>
    
    <!-- Next Menu Details -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Next Menu Details</h5>
            <div id="nextMenuDetails" class="mb-3 p-3 bg-light rounded">
                Loading...
            </div>
        </div>
    </div>

    <!-- Menu Preview -->
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Menu Preview</h5>
            <div class="preview-container" style="width: 100%; height: 800px; overflow: hidden;">
                <div id="loadingSpinner" style="display: none; text-align: center; padding: 20px;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
                <img id="menuPreview" 
                     style="width: 100%; height: auto; object-fit: contain; display: none;" 
                     alt="Next Menu Preview">
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadNextMenu();
});

async function loadNextMenu() {
    try {
        const response = await fetch('/api/next-menu');
        const data = await response.json();
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        // Update menu details
        document.getElementById('nextMenuDetails').innerHTML = `
            <div class="mt-2">
                <strong>Send Date:</strong> ${new Date(data.send_date).toLocaleDateString()}<br>
                <strong>Menu Week:</strong> ${data.season} Week ${data.week_number}<br>
                <strong>Menu Pair:</strong> ${data.menu_pair}
            </div>
        `;
        
        // Show menu preview
        if (data.menu_url) {
            const img = document.getElementById('menuPreview');
            document.getElementById('loadingSpinner').style.display = 'block';
            
            img.onload = () => {
                document.getElementById('loadingSpinner').style.display = 'none';
                img.style.display = 'block';
            };
            
            img.src = data.menu_url;
        }
        
    } catch (error) {
        document.getElementById('nextMenuDetails').innerHTML = `
            <div class="text-danger">
                <i class="fas fa-exclamation-circle"></i>
                Error: ${error.message}
            </div>
        `;
    }
}
</script>
{% endblock %} 